

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Multivariate quantiles and long horizon forecasting with N-HiTS &#8212; SajjadPSavoji/forecasting-bootcamp</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=__G_ANALYTICS_ID__"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', '__G_ANALYTICS_ID__');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'multivariate_demos/nhits_quantile';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Multivariate Forecasting Demo Notebooks" href="README.html" />
    <link rel="prev" title="Multivariate Forecasting with NBEATS" href="nbeats_electricity.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
    
    
      
    
    
    <img src="https://vectorinstitute.ai/wp-content/uploads/2022/11/logo-vector-institute-full-colour-01.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="https://vectorinstitute.ai/wp-content/uploads/2022/11/logo-vector-institute-full-colour-01.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    Forecasting Bootcamp
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../datasets/datasets_intro.html">Datasets intro</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../datasets/can_climate_data/data_explore.html">Load weather data and station metadata</a></li>




<li class="toctree-l2"><a class="reference internal" href="../datasets/m5/load_m5_dataset.html">M5 Data Preparation</a></li>

</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demo1_prophet_neuralprophet_testset.html">Data Loading</a></li>





<li class="toctree-l1"><a class="reference internal" href="../external_demos/m5-competition-eda-models.html">Introduction</a></li>







<li class="toctree-l1 has-children"><a class="reference internal" href="../intro_to_forecasting/intro_time_series.html">Intro time series</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro_to_forecasting/intro_time_series_2.html">Intro time series 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro_to_forecasting/README.html">Readme</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="deepar_electricty.html">Deepar electricty</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="nbeats_electricity.html">Nbeats electricity</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Nhits quantile</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html">Readme</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../multivariate_lstf_demos/autoformer_traffic.html">Autoformer traffic</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../multivariate_lstf_demos/nhits_traffic.html">Nhits traffic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multivariate_lstf_demos/README.html">Readme</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/SajjadPSavoji/forecasting-bootcamp/booklet?urlpath=lab/tree/./multivariate_demos/nhits_quantile.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/SajjadPSavoji/forecasting-bootcamp/blob/booklet/./multivariate_demos/nhits_quantile.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/SajjadPSavoji/forecasting-bootcamp" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/SajjadPSavoji/forecasting-bootcamp/edit/booklet/./multivariate_demos/nhits_quantile.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/SajjadPSavoji/forecasting-bootcamp/issues/new?title=Issue%20on%20page%20%2Fmultivariate_demos/nhits_quantile.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/multivariate_demos/nhits_quantile.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Multivariate quantiles and long horizon forecasting with N-HiTS</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#package-imports-and-global-variables">Package Imports and Global Variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-data">Load Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model">Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nhits-overview">NHITS Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-definition">Model Definition</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-and-validation">Training and Validation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-forecasts">Visualize Forecasts</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quantile-forecasts">Quantile Forecasts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretable-forecasts">Interpretable Forecasts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sampling-forecasts">Sampling Forecasts</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quantitative-results">Quantitative Results</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="multivariate-quantiles-and-long-horizon-forecasting-with-n-hits">
<h1>Multivariate quantiles and long horizon forecasting with N-HiTS<a class="headerlink" href="#multivariate-quantiles-and-long-horizon-forecasting-with-n-hits" title="Permalink to this heading">#</a></h1>
<p>This demo outines the application of the NHITS method using the PyTorch Forecasting. <a class="reference external" href="https://github.com/jdb78/pytorch-forecasting">PyTorch Forecasting</a> is a package that provides convenient implementations of several leading deep learning-based forecasting models, namely <a class="reference external" href="https://arxiv.org/pdf/1912.09363.pdf">Temporal Fusion Transformers</a>, <a class="reference external" href="http://arxiv.org/abs/1905.10437">N-BEATS</a>, and <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0169207019301888">DeepAR</a>. PyTorch Forecasting is built using <a class="reference external" href="https://pytorch-lightning.readthedocs.io/">PyTorch Lightning</a>, making it easier to train in multi-GPU compute environments, out-of-the-box. This demo was adapted from a tutorial in the <a class="reference external" href="https://pytorch-forecasting.readthedocs.io/en/stable/tutorials/nhits.html">PyTorch Forecasting Documentation</a>.</p>
<section id="package-imports-and-global-variables">
<h2>Package Imports and Global Variables<a class="headerlink" href="#package-imports-and-global-variables" title="Permalink to this heading">#</a></h2>
<p><strong>Note for Colab users:</strong> Run the following cell to install PyTorch Forecasting. After installation completes, you will likely need to restart the Colab runtime. If this is the case, a button <code class="docutils literal notranslate"><span class="pre">RESTART</span> <span class="pre">RUNTIME</span></code> will appear at the bottom of the next cell’s output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s1">&#39;google.colab&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">get_ipython</span><span class="p">()):</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>pytorch-forecasting<span class="o">[</span>mqf2<span class="o">]</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>pytorch<span class="w"> </span>lightning

    <span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
    <span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>
    <span class="c1"># !pip install -r &#39;/content/drive/MyDrive/bootcamp_datasets/forecasting_requirements.txt&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting pytorch-forecasting[mqf2]
  Downloading pytorch_forecasting-1.0.0-py3-none-any.whl (140 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">140.4/140.4 kB</span> <span class=" -Color -Color-Red">892.1 kB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hCollecting fastapi&gt;=0.80 (from pytorch-forecasting[mqf2])
  Downloading fastapi-0.100.1-py3-none-any.whl (65 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">65.8/65.8 kB</span> <span class=" -Color -Color-Red">5.4 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hCollecting lightning&lt;3.0.0,&gt;=2.0.0 (from pytorch-forecasting[mqf2])
  Downloading lightning-2.0.6-py3-none-any.whl (1.9 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">1.9/1.9 MB</span> <span class=" -Color -Color-Red">47.5 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: matplotlib in /usr/local/lib/python3.10/dist-packages (from pytorch-forecasting[mqf2]) (3.7.1)
Collecting optuna&lt;4.0.0,&gt;=3.1.0 (from pytorch-forecasting[mqf2])
  Downloading optuna-3.2.0-py3-none-any.whl (390 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">390.6/390.6 kB</span> <span class=" -Color -Color-Red">31.6 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: pandas&lt;=3.0.0,&gt;=1.3.0 in /usr/local/lib/python3.10/dist-packages (from pytorch-forecasting[mqf2]) (1.5.3)
Collecting pytorch-optimizer&lt;3.0.0,&gt;=2.5.1 (from pytorch-forecasting[mqf2])
  Downloading pytorch_optimizer-2.11.1-py3-none-any.whl (156 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">156.3/156.3 kB</span> <span class=" -Color -Color-Red">12.0 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: scikit-learn&lt;2.0,&gt;=1.2 in /usr/local/lib/python3.10/dist-packages (from pytorch-forecasting[mqf2]) (1.2.2)
Requirement already satisfied: scipy&lt;2.0,&gt;=1.8 in /usr/local/lib/python3.10/dist-packages (from pytorch-forecasting[mqf2]) (1.10.1)
Requirement already satisfied: statsmodels in /usr/local/lib/python3.10/dist-packages (from pytorch-forecasting[mqf2]) (0.13.5)
Requirement already satisfied: torch&lt;3.0.0,&gt;=2.0.0 in /usr/local/lib/python3.10/dist-packages (from pytorch-forecasting[mqf2]) (2.0.1+cu118)
Collecting cpflows&lt;0.2.0,&gt;=0.1.2 (from pytorch-forecasting[mqf2])
  Downloading cpflows-0.1.2.tar.gz (42 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">42.9/42.9 kB</span> <span class=" -Color -Color-Red">4.5 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25h  Preparing metadata (setup.py) ... ?25l?25hdone
Collecting backports.functools-lru-cache&gt;=1.6.1 (from cpflows&lt;0.2.0,&gt;=0.1.2-&gt;pytorch-forecasting[mqf2])
  Downloading backports.functools_lru_cache-1.6.6-py2.py3-none-any.whl (5.9 kB)
Requirement already satisfied: cycler&gt;=0.10.0 in /usr/local/lib/python3.10/dist-packages (from cpflows&lt;0.2.0,&gt;=0.1.2-&gt;pytorch-forecasting[mqf2]) (0.11.0)
Requirement already satisfied: future&gt;=0.17.1 in /usr/local/lib/python3.10/dist-packages (from cpflows&lt;0.2.0,&gt;=0.1.2-&gt;pytorch-forecasting[mqf2]) (0.18.3)
Requirement already satisfied: kiwisolver&gt;=1.1.0 in /usr/local/lib/python3.10/dist-packages (from cpflows&lt;0.2.0,&gt;=0.1.2-&gt;pytorch-forecasting[mqf2]) (1.4.4)
Requirement already satisfied: numpy&gt;=1.16 in /usr/local/lib/python3.10/dist-packages (from cpflows&lt;0.2.0,&gt;=0.1.2-&gt;pytorch-forecasting[mqf2]) (1.22.4)
Requirement already satisfied: pyparsing&gt;=2.4.7 in /usr/local/lib/python3.10/dist-packages (from cpflows&lt;0.2.0,&gt;=0.1.2-&gt;pytorch-forecasting[mqf2]) (3.1.0)
Requirement already satisfied: python-dateutil&gt;=2.8.1 in /usr/local/lib/python3.10/dist-packages (from cpflows&lt;0.2.0,&gt;=0.1.2-&gt;pytorch-forecasting[mqf2]) (2.8.2)
Requirement already satisfied: pytz&gt;=2020.1 in /usr/local/lib/python3.10/dist-packages (from cpflows&lt;0.2.0,&gt;=0.1.2-&gt;pytorch-forecasting[mqf2]) (2022.7.1)
Requirement already satisfied: seaborn&gt;=0.9.1 in /usr/local/lib/python3.10/dist-packages (from cpflows&lt;0.2.0,&gt;=0.1.2-&gt;pytorch-forecasting[mqf2]) (0.12.2)
Requirement already satisfied: six&gt;=1.15.0 in /usr/local/lib/python3.10/dist-packages (from cpflows&lt;0.2.0,&gt;=0.1.2-&gt;pytorch-forecasting[mqf2]) (1.16.0)
Collecting subprocess32&gt;=3.5.3 (from cpflows&lt;0.2.0,&gt;=0.1.2-&gt;pytorch-forecasting[mqf2])
  Downloading subprocess32-3.5.4.tar.gz (97 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">97.4/97.4 kB</span> <span class=" -Color -Color-Red">8.1 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25h  Preparing metadata (setup.py) ... ?25l?25hdone
Requirement already satisfied: torchvision in /usr/local/lib/python3.10/dist-packages (from cpflows&lt;0.2.0,&gt;=0.1.2-&gt;pytorch-forecasting[mqf2]) (0.15.2+cu118)
Requirement already satisfied: tqdm&gt;=4.23 in /usr/local/lib/python3.10/dist-packages (from cpflows&lt;0.2.0,&gt;=0.1.2-&gt;pytorch-forecasting[mqf2]) (4.65.0)
Requirement already satisfied: h5py in /usr/local/lib/python3.10/dist-packages (from cpflows&lt;0.2.0,&gt;=0.1.2-&gt;pytorch-forecasting[mqf2]) (3.8.0)
Requirement already satisfied: pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,&lt;3.0.0,&gt;=1.7.4 in /usr/local/lib/python3.10/dist-packages (from fastapi&gt;=0.80-&gt;pytorch-forecasting[mqf2]) (1.10.12)
Collecting starlette&lt;0.28.0,&gt;=0.27.0 (from fastapi&gt;=0.80-&gt;pytorch-forecasting[mqf2])
  Downloading starlette-0.27.0-py3-none-any.whl (66 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">67.0/67.0 kB</span> <span class=" -Color -Color-Red">6.3 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: typing-extensions&gt;=4.5.0 in /usr/local/lib/python3.10/dist-packages (from fastapi&gt;=0.80-&gt;pytorch-forecasting[mqf2]) (4.7.1)
Requirement already satisfied: Jinja2&lt;5.0 in /usr/local/lib/python3.10/dist-packages (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (3.1.2)
Requirement already satisfied: PyYAML&lt;8.0 in /usr/local/lib/python3.10/dist-packages (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (6.0.1)
Collecting arrow&lt;3.0,&gt;=1.2.0 (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading arrow-1.2.3-py3-none-any.whl (66 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">66.4/66.4 kB</span> <span class=" -Color -Color-Red">5.9 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hCollecting backoff&lt;4.0,&gt;=2.2.1 (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading backoff-2.2.1-py3-none-any.whl (15 kB)
Requirement already satisfied: beautifulsoup4&lt;6.0,&gt;=4.8.0 in /usr/local/lib/python3.10/dist-packages (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (4.11.2)
Requirement already satisfied: click&lt;10.0 in /usr/local/lib/python3.10/dist-packages (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (8.1.6)
Collecting croniter&lt;1.5.0,&gt;=1.3.0 (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading croniter-1.4.1-py2.py3-none-any.whl (19 kB)
Collecting dateutils&lt;2.0 (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading dateutils-0.6.12-py2.py3-none-any.whl (5.7 kB)
Collecting deepdiff&lt;8.0,&gt;=5.7.0 (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading deepdiff-6.3.1-py3-none-any.whl (70 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">70.7/70.7 kB</span> <span class=" -Color -Color-Red">5.0 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: fsspec&lt;2025.0,&gt;=2022.5.0 in /usr/local/lib/python3.10/dist-packages (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (2023.6.0)
Collecting inquirer&lt;5.0,&gt;=2.10.0 (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading inquirer-3.1.3-py3-none-any.whl (18 kB)
Collecting lightning-cloud&gt;=0.5.37 (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading lightning_cloud-0.5.37-py3-none-any.whl (596 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">596.7/596.7 kB</span> <span class=" -Color -Color-Red">39.2 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hCollecting lightning-utilities&lt;2.0,&gt;=0.7.0 (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading lightning_utilities-0.9.0-py3-none-any.whl (23 kB)
Requirement already satisfied: packaging in /usr/local/lib/python3.10/dist-packages (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (23.1)
Requirement already satisfied: psutil&lt;7.0 in /usr/local/lib/python3.10/dist-packages (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (5.9.5)
Collecting python-multipart&lt;2.0,&gt;=0.0.5 (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading python_multipart-0.0.6-py3-none-any.whl (45 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">45.7/45.7 kB</span> <span class=" -Color -Color-Red">3.4 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: requests&lt;4.0 in /usr/local/lib/python3.10/dist-packages (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (2.27.1)
Requirement already satisfied: rich&lt;15.0,&gt;=12.3.0 in /usr/local/lib/python3.10/dist-packages (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (13.4.2)
Collecting starsessions&lt;2.0,&gt;=1.2.1 (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading starsessions-1.3.0-py3-none-any.whl (10 kB)
Collecting torchmetrics&lt;2.0,&gt;=0.7.0 (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading torchmetrics-1.0.1-py3-none-any.whl (729 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">729.2/729.2 kB</span> <span class=" -Color -Color-Red">24.4 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: traitlets&lt;7.0,&gt;=5.3.0 in /usr/local/lib/python3.10/dist-packages (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (5.7.1)
Requirement already satisfied: urllib3&lt;4.0 in /usr/local/lib/python3.10/dist-packages (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (1.26.16)
Collecting uvicorn&lt;2.0 (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading uvicorn-0.23.2-py3-none-any.whl (59 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">59.5/59.5 kB</span> <span class=" -Color -Color-Red">3.3 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: websocket-client&lt;3.0 in /usr/local/lib/python3.10/dist-packages (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (1.6.1)
Collecting websockets&lt;13.0 (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading websockets-11.0.3-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (129 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">129.9/129.9 kB</span> <span class=" -Color -Color-Red">4.7 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hCollecting pytorch-lightning (from lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading pytorch_lightning-2.0.6-py3-none-any.whl (722 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">722.8/722.8 kB</span> <span class=" -Color -Color-Red">32.2 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: contourpy&gt;=1.0.1 in /usr/local/lib/python3.10/dist-packages (from matplotlib-&gt;pytorch-forecasting[mqf2]) (1.1.0)
Requirement already satisfied: fonttools&gt;=4.22.0 in /usr/local/lib/python3.10/dist-packages (from matplotlib-&gt;pytorch-forecasting[mqf2]) (4.41.1)
Requirement already satisfied: pillow&gt;=6.2.0 in /usr/local/lib/python3.10/dist-packages (from matplotlib-&gt;pytorch-forecasting[mqf2]) (9.4.0)
Collecting alembic&gt;=1.5.0 (from optuna&lt;4.0.0,&gt;=3.1.0-&gt;pytorch-forecasting[mqf2])
  Downloading alembic-1.11.1-py3-none-any.whl (224 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">224.5/224.5 kB</span> <span class=" -Color -Color-Red">5.3 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hCollecting cmaes&gt;=0.9.1 (from optuna&lt;4.0.0,&gt;=3.1.0-&gt;pytorch-forecasting[mqf2])
  Downloading cmaes-0.10.0-py3-none-any.whl (29 kB)
Collecting colorlog (from optuna&lt;4.0.0,&gt;=3.1.0-&gt;pytorch-forecasting[mqf2])
  Downloading colorlog-6.7.0-py2.py3-none-any.whl (11 kB)
Requirement already satisfied: sqlalchemy&gt;=1.3.0 in /usr/local/lib/python3.10/dist-packages (from optuna&lt;4.0.0,&gt;=3.1.0-&gt;pytorch-forecasting[mqf2]) (2.0.19)
Requirement already satisfied: joblib&gt;=1.1.1 in /usr/local/lib/python3.10/dist-packages (from scikit-learn&lt;2.0,&gt;=1.2-&gt;pytorch-forecasting[mqf2]) (1.3.1)
Requirement already satisfied: threadpoolctl&gt;=2.0.0 in /usr/local/lib/python3.10/dist-packages (from scikit-learn&lt;2.0,&gt;=1.2-&gt;pytorch-forecasting[mqf2]) (3.2.0)
Requirement already satisfied: filelock in /usr/local/lib/python3.10/dist-packages (from torch&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (3.12.2)
Requirement already satisfied: sympy in /usr/local/lib/python3.10/dist-packages (from torch&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (1.11.1)
Requirement already satisfied: networkx in /usr/local/lib/python3.10/dist-packages (from torch&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (3.1)
Requirement already satisfied: triton==2.0.0 in /usr/local/lib/python3.10/dist-packages (from torch&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (2.0.0)
Requirement already satisfied: cmake in /usr/local/lib/python3.10/dist-packages (from triton==2.0.0-&gt;torch&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (3.25.2)
Requirement already satisfied: lit in /usr/local/lib/python3.10/dist-packages (from triton==2.0.0-&gt;torch&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (16.0.6)
Requirement already satisfied: patsy&gt;=0.5.2 in /usr/local/lib/python3.10/dist-packages (from statsmodels-&gt;pytorch-forecasting[mqf2]) (0.5.3)
Collecting Mako (from alembic&gt;=1.5.0-&gt;optuna&lt;4.0.0,&gt;=3.1.0-&gt;pytorch-forecasting[mqf2])
  Downloading Mako-1.2.4-py3-none-any.whl (78 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">78.7/78.7 kB</span> <span class=" -Color -Color-Red">5.2 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: soupsieve&gt;1.2 in /usr/local/lib/python3.10/dist-packages (from beautifulsoup4&lt;6.0,&gt;=4.8.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (2.4.1)
Collecting ordered-set&lt;4.2.0,&gt;=4.0.2 (from deepdiff&lt;8.0,&gt;=5.7.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading ordered_set-4.1.0-py3-none-any.whl (7.6 kB)
Requirement already satisfied: aiohttp!=4.0.0a0,!=4.0.0a1 in /usr/local/lib/python3.10/dist-packages (from fsspec&lt;2025.0,&gt;=2022.5.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (3.8.5)
Collecting blessed&gt;=1.19.0 (from inquirer&lt;5.0,&gt;=2.10.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading blessed-1.20.0-py2.py3-none-any.whl (58 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">58.4/58.4 kB</span> <span class=" -Color -Color-Red">3.2 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hCollecting python-editor&gt;=1.0.4 (from inquirer&lt;5.0,&gt;=2.10.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading python_editor-1.0.4-py3-none-any.whl (4.9 kB)
Collecting readchar&gt;=3.0.6 (from inquirer&lt;5.0,&gt;=2.10.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading readchar-4.0.5-py3-none-any.whl (8.5 kB)
Requirement already satisfied: MarkupSafe&gt;=2.0 in /usr/local/lib/python3.10/dist-packages (from Jinja2&lt;5.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (2.1.3)
Requirement already satisfied: pyjwt in /usr/lib/python3/dist-packages (from lightning-cloud&gt;=0.5.37-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (2.3.0)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests&lt;4.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (2023.7.22)
Requirement already satisfied: charset-normalizer~=2.0.0 in /usr/local/lib/python3.10/dist-packages (from requests&lt;4.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (2.0.12)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.10/dist-packages (from requests&lt;4.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (3.4)
Requirement already satisfied: markdown-it-py&gt;=2.2.0 in /usr/local/lib/python3.10/dist-packages (from rich&lt;15.0,&gt;=12.3.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (3.0.0)
Requirement already satisfied: pygments&lt;3.0.0,&gt;=2.13.0 in /usr/local/lib/python3.10/dist-packages (from rich&lt;15.0,&gt;=12.3.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (2.14.0)
Requirement already satisfied: greenlet!=0.4.17 in /usr/local/lib/python3.10/dist-packages (from sqlalchemy&gt;=1.3.0-&gt;optuna&lt;4.0.0,&gt;=3.1.0-&gt;pytorch-forecasting[mqf2]) (2.0.2)
Requirement already satisfied: anyio&lt;5,&gt;=3.4.0 in /usr/local/lib/python3.10/dist-packages (from starlette&lt;0.28.0,&gt;=0.27.0-&gt;fastapi&gt;=0.80-&gt;pytorch-forecasting[mqf2]) (3.7.1)
Requirement already satisfied: itsdangerous&lt;3.0.0,&gt;=2.0.1 in /usr/local/lib/python3.10/dist-packages (from starsessions&lt;2.0,&gt;=1.2.1-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (2.1.2)
Collecting h11&gt;=0.8 (from uvicorn&lt;2.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2])
  Downloading h11-0.14.0-py3-none-any.whl (58 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">58.3/58.3 kB</span> <span class=" -Color -Color-Red">7.3 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: mpmath&gt;=0.19 in /usr/local/lib/python3.10/dist-packages (from sympy-&gt;torch&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (1.3.0)
Requirement already satisfied: attrs&gt;=17.3.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec&lt;2025.0,&gt;=2022.5.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (23.1.0)
Requirement already satisfied: multidict&lt;7.0,&gt;=4.5 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec&lt;2025.0,&gt;=2022.5.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (6.0.4)
Requirement already satisfied: async-timeout&lt;5.0,&gt;=4.0.0a3 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec&lt;2025.0,&gt;=2022.5.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (4.0.2)
Requirement already satisfied: yarl&lt;2.0,&gt;=1.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec&lt;2025.0,&gt;=2022.5.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (1.9.2)
Requirement already satisfied: frozenlist&gt;=1.1.1 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec&lt;2025.0,&gt;=2022.5.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (1.4.0)
Requirement already satisfied: aiosignal&gt;=1.1.2 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec&lt;2025.0,&gt;=2022.5.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (1.3.1)
Requirement already satisfied: sniffio&gt;=1.1 in /usr/local/lib/python3.10/dist-packages (from anyio&lt;5,&gt;=3.4.0-&gt;starlette&lt;0.28.0,&gt;=0.27.0-&gt;fastapi&gt;=0.80-&gt;pytorch-forecasting[mqf2]) (1.3.0)
Requirement already satisfied: exceptiongroup in /usr/local/lib/python3.10/dist-packages (from anyio&lt;5,&gt;=3.4.0-&gt;starlette&lt;0.28.0,&gt;=0.27.0-&gt;fastapi&gt;=0.80-&gt;pytorch-forecasting[mqf2]) (1.1.2)
Requirement already satisfied: wcwidth&gt;=0.1.4 in /usr/local/lib/python3.10/dist-packages (from blessed&gt;=1.19.0-&gt;inquirer&lt;5.0,&gt;=2.10.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (0.2.6)
Requirement already satisfied: mdurl~=0.1 in /usr/local/lib/python3.10/dist-packages (from markdown-it-py&gt;=2.2.0-&gt;rich&lt;15.0,&gt;=12.3.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (0.1.2)
Requirement already satisfied: setuptools&gt;=41.0 in /usr/local/lib/python3.10/dist-packages (from readchar&gt;=3.0.6-&gt;inquirer&lt;5.0,&gt;=2.10.0-&gt;lightning&lt;3.0.0,&gt;=2.0.0-&gt;pytorch-forecasting[mqf2]) (67.7.2)
Building wheels for collected packages: cpflows, subprocess32
  Building wheel for cpflows (setup.py) ... ?25l?25hdone
  Created wheel for cpflows: filename=cpflows-0.1.2-py3-none-any.whl size=54298 sha256=965a8ca494f7b442c4d7ad438eb2455ef81919baca3f06fe013845249acaba39
  Stored in directory: /root/.cache/pip/wheels/1b/c3/fd/cdcca84615eb336ec3d17d9d1fd858684240e91b47cf3dab6e
  Building wheel for subprocess32 (setup.py) ... ?25l?25hdone
  Created wheel for subprocess32: filename=subprocess32-3.5.4-py3-none-any.whl size=6486 sha256=497aafc675e9c3305cd7c58a47a1c022acb57fa4e5bc39c9a7aad0bbeccaacac
  Stored in directory: /root/.cache/pip/wheels/64/19/61/d440ccd46a2a014bce61fc5c6c8495dedd32ef04cba8b34b28
Successfully built cpflows subprocess32
Installing collected packages: python-editor, websockets, subprocess32, readchar, python-multipart, ordered-set, Mako, lightning-utilities, h11, colorlog, cmaes, blessed, backports.functools-lru-cache, backoff, uvicorn, starlette, inquirer, deepdiff, dateutils, croniter, arrow, alembic, starsessions, optuna, fastapi, lightning-cloud, torchmetrics, pytorch-lightning, pytorch-optimizer, lightning, pytorch-forecasting, cpflows
Successfully installed Mako-1.2.4 alembic-1.11.1 arrow-1.2.3 backoff-2.2.1 backports.functools-lru-cache-1.6.6 blessed-1.20.0 cmaes-0.10.0 colorlog-6.7.0 cpflows-0.1.2 croniter-1.4.1 dateutils-0.6.12 deepdiff-6.3.1 fastapi-0.100.1 h11-0.14.0 inquirer-3.1.3 lightning-2.0.6 lightning-cloud-0.5.37 lightning-utilities-0.9.0 optuna-3.2.0 ordered-set-4.1.0 python-editor-1.0.4 python-multipart-0.0.6 pytorch-forecasting-1.0.0 pytorch-lightning-2.0.6 pytorch-optimizer-2.11.1 readchar-4.0.5 starlette-0.27.0 starsessions-1.3.0 subprocess32-3.5.4 torchmetrics-1.0.1 uvicorn-0.23.2 websockets-11.0.3
Collecting pytorch
  Downloading pytorch-1.0.2.tar.gz (689 bytes)
  Preparing metadata (setup.py) ... ?25l?25hdone
Requirement already satisfied: lightning in /usr/local/lib/python3.10/dist-packages (2.0.6)
Requirement already satisfied: Jinja2&lt;5.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (3.1.2)
Requirement already satisfied: PyYAML&lt;8.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (6.0.1)
Requirement already satisfied: arrow&lt;3.0,&gt;=1.2.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (1.2.3)
Requirement already satisfied: backoff&lt;4.0,&gt;=2.2.1 in /usr/local/lib/python3.10/dist-packages (from lightning) (2.2.1)
Requirement already satisfied: beautifulsoup4&lt;6.0,&gt;=4.8.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (4.11.2)
Requirement already satisfied: click&lt;10.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (8.1.6)
Requirement already satisfied: croniter&lt;1.5.0,&gt;=1.3.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (1.4.1)
Requirement already satisfied: dateutils&lt;2.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (0.6.12)
Requirement already satisfied: deepdiff&lt;8.0,&gt;=5.7.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (6.3.1)
Requirement already satisfied: fastapi&lt;2.0,&gt;=0.92.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (0.100.1)
Requirement already satisfied: fsspec&lt;2025.0,&gt;=2022.5.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (2023.6.0)
Requirement already satisfied: inquirer&lt;5.0,&gt;=2.10.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (3.1.3)
Requirement already satisfied: lightning-cloud&gt;=0.5.37 in /usr/local/lib/python3.10/dist-packages (from lightning) (0.5.37)
Requirement already satisfied: lightning-utilities&lt;2.0,&gt;=0.7.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (0.9.0)
Requirement already satisfied: numpy&lt;3.0,&gt;=1.17.2 in /usr/local/lib/python3.10/dist-packages (from lightning) (1.22.4)
Requirement already satisfied: packaging in /usr/local/lib/python3.10/dist-packages (from lightning) (23.1)
Requirement already satisfied: psutil&lt;7.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (5.9.5)
Requirement already satisfied: pydantic&lt;2.1.0,&gt;=1.7.4 in /usr/local/lib/python3.10/dist-packages (from lightning) (1.10.12)
Requirement already satisfied: python-multipart&lt;2.0,&gt;=0.0.5 in /usr/local/lib/python3.10/dist-packages (from lightning) (0.0.6)
Requirement already satisfied: requests&lt;4.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (2.27.1)
Requirement already satisfied: rich&lt;15.0,&gt;=12.3.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (13.4.2)
Requirement already satisfied: starlette in /usr/local/lib/python3.10/dist-packages (from lightning) (0.27.0)
Requirement already satisfied: starsessions&lt;2.0,&gt;=1.2.1 in /usr/local/lib/python3.10/dist-packages (from lightning) (1.3.0)
Requirement already satisfied: torch&lt;4.0,&gt;=1.11.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (2.0.1+cu118)
Requirement already satisfied: torchmetrics&lt;2.0,&gt;=0.7.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (1.0.1)
Requirement already satisfied: tqdm&lt;6.0,&gt;=4.57.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (4.65.0)
Requirement already satisfied: traitlets&lt;7.0,&gt;=5.3.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (5.7.1)
Requirement already satisfied: typing-extensions&lt;6.0,&gt;=4.0.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (4.7.1)
Requirement already satisfied: urllib3&lt;4.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (1.26.16)
Requirement already satisfied: uvicorn&lt;2.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (0.23.2)
Requirement already satisfied: websocket-client&lt;3.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (1.6.1)
Requirement already satisfied: websockets&lt;13.0 in /usr/local/lib/python3.10/dist-packages (from lightning) (11.0.3)
Requirement already satisfied: pytorch-lightning in /usr/local/lib/python3.10/dist-packages (from lightning) (2.0.6)
Requirement already satisfied: python-dateutil&gt;=2.7.0 in /usr/local/lib/python3.10/dist-packages (from arrow&lt;3.0,&gt;=1.2.0-&gt;lightning) (2.8.2)
Requirement already satisfied: soupsieve&gt;1.2 in /usr/local/lib/python3.10/dist-packages (from beautifulsoup4&lt;6.0,&gt;=4.8.0-&gt;lightning) (2.4.1)
Requirement already satisfied: pytz in /usr/local/lib/python3.10/dist-packages (from dateutils&lt;2.0-&gt;lightning) (2022.7.1)
Requirement already satisfied: ordered-set&lt;4.2.0,&gt;=4.0.2 in /usr/local/lib/python3.10/dist-packages (from deepdiff&lt;8.0,&gt;=5.7.0-&gt;lightning) (4.1.0)
Requirement already satisfied: aiohttp!=4.0.0a0,!=4.0.0a1 in /usr/local/lib/python3.10/dist-packages (from fsspec&lt;2025.0,&gt;=2022.5.0-&gt;lightning) (3.8.5)
Requirement already satisfied: blessed&gt;=1.19.0 in /usr/local/lib/python3.10/dist-packages (from inquirer&lt;5.0,&gt;=2.10.0-&gt;lightning) (1.20.0)
Requirement already satisfied: python-editor&gt;=1.0.4 in /usr/local/lib/python3.10/dist-packages (from inquirer&lt;5.0,&gt;=2.10.0-&gt;lightning) (1.0.4)
Requirement already satisfied: readchar&gt;=3.0.6 in /usr/local/lib/python3.10/dist-packages (from inquirer&lt;5.0,&gt;=2.10.0-&gt;lightning) (4.0.5)
Requirement already satisfied: MarkupSafe&gt;=2.0 in /usr/local/lib/python3.10/dist-packages (from Jinja2&lt;5.0-&gt;lightning) (2.1.3)
Requirement already satisfied: pyjwt in /usr/lib/python3/dist-packages (from lightning-cloud&gt;=0.5.37-&gt;lightning) (2.3.0)
Requirement already satisfied: six in /usr/local/lib/python3.10/dist-packages (from lightning-cloud&gt;=0.5.37-&gt;lightning) (1.16.0)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests&lt;4.0-&gt;lightning) (2023.7.22)
Requirement already satisfied: charset-normalizer~=2.0.0 in /usr/local/lib/python3.10/dist-packages (from requests&lt;4.0-&gt;lightning) (2.0.12)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.10/dist-packages (from requests&lt;4.0-&gt;lightning) (3.4)
Requirement already satisfied: markdown-it-py&gt;=2.2.0 in /usr/local/lib/python3.10/dist-packages (from rich&lt;15.0,&gt;=12.3.0-&gt;lightning) (3.0.0)
Requirement already satisfied: pygments&lt;3.0.0,&gt;=2.13.0 in /usr/local/lib/python3.10/dist-packages (from rich&lt;15.0,&gt;=12.3.0-&gt;lightning) (2.14.0)
Requirement already satisfied: anyio&lt;5,&gt;=3.4.0 in /usr/local/lib/python3.10/dist-packages (from starlette-&gt;lightning) (3.7.1)
Requirement already satisfied: itsdangerous&lt;3.0.0,&gt;=2.0.1 in /usr/local/lib/python3.10/dist-packages (from starsessions&lt;2.0,&gt;=1.2.1-&gt;lightning) (2.1.2)
Requirement already satisfied: filelock in /usr/local/lib/python3.10/dist-packages (from torch&lt;4.0,&gt;=1.11.0-&gt;lightning) (3.12.2)
Requirement already satisfied: sympy in /usr/local/lib/python3.10/dist-packages (from torch&lt;4.0,&gt;=1.11.0-&gt;lightning) (1.11.1)
Requirement already satisfied: networkx in /usr/local/lib/python3.10/dist-packages (from torch&lt;4.0,&gt;=1.11.0-&gt;lightning) (3.1)
Requirement already satisfied: triton==2.0.0 in /usr/local/lib/python3.10/dist-packages (from torch&lt;4.0,&gt;=1.11.0-&gt;lightning) (2.0.0)
Requirement already satisfied: cmake in /usr/local/lib/python3.10/dist-packages (from triton==2.0.0-&gt;torch&lt;4.0,&gt;=1.11.0-&gt;lightning) (3.25.2)
Requirement already satisfied: lit in /usr/local/lib/python3.10/dist-packages (from triton==2.0.0-&gt;torch&lt;4.0,&gt;=1.11.0-&gt;lightning) (16.0.6)
Requirement already satisfied: h11&gt;=0.8 in /usr/local/lib/python3.10/dist-packages (from uvicorn&lt;2.0-&gt;lightning) (0.14.0)
Requirement already satisfied: attrs&gt;=17.3.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec&lt;2025.0,&gt;=2022.5.0-&gt;lightning) (23.1.0)
Requirement already satisfied: multidict&lt;7.0,&gt;=4.5 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec&lt;2025.0,&gt;=2022.5.0-&gt;lightning) (6.0.4)
Requirement already satisfied: async-timeout&lt;5.0,&gt;=4.0.0a3 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec&lt;2025.0,&gt;=2022.5.0-&gt;lightning) (4.0.2)
Requirement already satisfied: yarl&lt;2.0,&gt;=1.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec&lt;2025.0,&gt;=2022.5.0-&gt;lightning) (1.9.2)
Requirement already satisfied: frozenlist&gt;=1.1.1 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec&lt;2025.0,&gt;=2022.5.0-&gt;lightning) (1.4.0)
Requirement already satisfied: aiosignal&gt;=1.1.2 in /usr/local/lib/python3.10/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec&lt;2025.0,&gt;=2022.5.0-&gt;lightning) (1.3.1)
Requirement already satisfied: sniffio&gt;=1.1 in /usr/local/lib/python3.10/dist-packages (from anyio&lt;5,&gt;=3.4.0-&gt;starlette-&gt;lightning) (1.3.0)
Requirement already satisfied: exceptiongroup in /usr/local/lib/python3.10/dist-packages (from anyio&lt;5,&gt;=3.4.0-&gt;starlette-&gt;lightning) (1.1.2)
Requirement already satisfied: wcwidth&gt;=0.1.4 in /usr/local/lib/python3.10/dist-packages (from blessed&gt;=1.19.0-&gt;inquirer&lt;5.0,&gt;=2.10.0-&gt;lightning) (0.2.6)
Requirement already satisfied: mdurl~=0.1 in /usr/local/lib/python3.10/dist-packages (from markdown-it-py&gt;=2.2.0-&gt;rich&lt;15.0,&gt;=12.3.0-&gt;lightning) (0.1.2)
Requirement already satisfied: setuptools&gt;=41.0 in /usr/local/lib/python3.10/dist-packages (from readchar&gt;=3.0.6-&gt;inquirer&lt;5.0,&gt;=2.10.0-&gt;lightning) (67.7.2)
Requirement already satisfied: mpmath&gt;=0.19 in /usr/local/lib/python3.10/dist-packages (from sympy-&gt;torch&lt;4.0,&gt;=1.11.0-&gt;lightning) (1.3.0)
Building wheels for collected packages: pytorch
  <span class=" -Color -Color-Bold -Color-Bold-Red">error</span>: <span class=" -Color -Color-Bold">subprocess-exited-with-error</span>
  
  <span class=" -Color -Color-Red">×</span> <span class=" -Color -Color-Green">python setup.py bdist_wheel</span> did not run successfully.
  <span class=" -Color -Color-Red">│</span> exit code: <span class=" -Color -Color-Bold -Color-Bold-Cyan">1</span>
  <span class=" -Color -Color-Red">╰─&gt;</span> See above for output.
  
  <span class=" -Color -Color-Bold -Color-Bold-Magenta">note</span>: This error originates from a subprocess, and is likely not a problem with pip.
  Building wheel for pytorch (setup.py) ... ?25lerror
<span class=" -Color -Color-Red">  ERROR: Failed building wheel for pytorch</span>
?25h  Running setup.py clean for pytorch
Failed to build pytorch
<span class=" -Color -Color-Red">ERROR: Could not build wheels for pytorch, which is required to install pyproject.toml-based projects</span>
Mounted at /content/drive
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-1-d3ad2ad8900a&gt;</span> in <span class="ni">&lt;cell line: 9&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="c1"># !pip install -r &#39;/content/drive/MyDrive/bootcamp_datasets/forecasting_requirements.txt&#39;</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> 
<span class="ne">----&gt; </span><span class="mi">9</span> <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;warnings&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>please restart the run-time after the installations</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pytorch_lightning</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">from</span> <span class="nn">pytorch_lightning.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">from</span> <span class="nn">pytorch_forecasting</span> <span class="kn">import</span> <span class="n">Baseline</span><span class="p">,</span> <span class="n">NHiTS</span><span class="p">,</span> <span class="n">TimeSeriesDataSet</span>
<span class="kn">from</span> <span class="nn">pytorch_forecasting.data</span> <span class="kn">import</span> <span class="n">NaNLabelEncoder</span>
<span class="kn">from</span> <span class="nn">pytorch_forecasting.data.examples</span> <span class="kn">import</span> <span class="n">generate_ar_data</span>
<span class="kn">from</span> <span class="nn">pytorch_forecasting.metrics</span> <span class="kn">import</span> <span class="n">SMAPE</span><span class="p">,</span> <span class="n">MQF2DistributionLoss</span><span class="p">,</span> <span class="n">QuantileLoss</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-data">
<h2>Load Data<a class="headerlink" href="#load-data" title="Permalink to this heading">#</a></h2>
<p>PyTorch forecasting provides the ability to generate a synthetic dataset using the <code class="docutils literal notranslate"><span class="pre">generate_ar_data</span></code> function. The generated data consists of 100 time series each with 400 time steps. Each time series is generated with the specified seasonality, trend and level along with a noise term. This is the time series we will be working with throughout the demo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">generate_ar_data</span><span class="p">(</span><span class="n">seasonality</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">timesteps</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">n_series</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;2020-01-01&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time_idx</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">

  <div id="df-c1578812-346d-45b7-a695-f8de08bc79c2">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>series</th>
      <th>time_idx</th>
      <th>value</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>-0.000000</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>1</td>
      <td>-0.046501</td>
      <td>2020-01-02</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>2</td>
      <td>-0.097796</td>
      <td>2020-01-03</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>3</td>
      <td>-0.144397</td>
      <td>2020-01-04</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>4</td>
      <td>-0.177954</td>
      <td>2020-01-05</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-c1578812-346d-45b7-a695-f8de08bc79c2')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>



    <div id="df-040bf7e7-cccb-476f-b079-c8d235f8bb45">
      <button class="colab-df-quickchart" onclick="quickchart('df-040bf7e7-cccb-476f-b079-c8d235f8bb45')"
              title="Suggest charts."
              style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>
    </div>

<style>
  .colab-df-quickchart {
    background-color: #E8F0FE;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: #1967D2;
    height: 32px;
    padding: 0 0 0 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: #E2EBFA;
    box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: #174EA6;
  }

  [theme=dark] .colab-df-quickchart {
    background-color: #3B4455;
    fill: #D2E3FC;
  }

  [theme=dark] .colab-df-quickchart:hover {
    background-color: #434B5C;
    box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
    filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
    fill: #FFFFFF;
  }
</style>

    <script>
      async function quickchart(key) {
        const containerElement = document.querySelector('#' + key);
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      }
    </script>

      <script>

function displayQuickchartButton(domScope) {
  let quickchartButtonEl =
    domScope.querySelector('#df-040bf7e7-cccb-476f-b079-c8d235f8bb45 button.colab-df-quickchart');
  quickchartButtonEl.style.display =
    google.colab.kernel.accessAllowed ? 'block' : 'none';
}

        displayQuickchartButton(document);
      </script>
      <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-c1578812-346d-45b7-a695-f8de08bc79c2 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-c1578812-346d-45b7-a695-f8de08bc79c2');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create dataset and dataloaders</span>
<span class="n">max_encoder_length</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">max_prediction_length</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">training_cutoff</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_idx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">max_prediction_length</span>

<span class="n">context_length</span> <span class="o">=</span> <span class="n">max_encoder_length</span>
<span class="n">prediction_length</span> <span class="o">=</span> <span class="n">max_prediction_length</span>

<span class="n">training</span> <span class="o">=</span> <span class="n">TimeSeriesDataSet</span><span class="p">(</span>
    <span class="n">data</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">time_idx</span> <span class="o">&lt;=</span> <span class="n">training_cutoff</span><span class="p">],</span>
    <span class="n">time_idx</span><span class="o">=</span><span class="s2">&quot;time_idx&quot;</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
    <span class="n">categorical_encoders</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;series&quot;</span><span class="p">:</span> <span class="n">NaNLabelEncoder</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">series</span><span class="p">)},</span>
    <span class="n">group_ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;series&quot;</span><span class="p">],</span>
    <span class="n">time_varying_unknown_reals</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
    <span class="n">max_encoder_length</span><span class="o">=</span><span class="n">context_length</span><span class="p">,</span>
    <span class="n">max_prediction_length</span><span class="o">=</span><span class="n">prediction_length</span><span class="p">,</span>

<span class="p">)</span>

<span class="n">validation</span> <span class="o">=</span> <span class="n">TimeSeriesDataSet</span><span class="o">.</span><span class="n">from_dataset</span><span class="p">(</span><span class="n">training</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">min_prediction_idx</span><span class="o">=</span><span class="n">training_cutoff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">train_dataloader</span> <span class="o">=</span> <span class="n">training</span><span class="o">.</span><span class="n">to_dataloader</span><span class="p">(</span><span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">val_dataloader</span> <span class="o">=</span> <span class="n">validation</span><span class="o">.</span><span class="n">to_dataloader</span><span class="p">(</span><span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="model">
<h2>Model<a class="headerlink" href="#model" title="Permalink to this heading">#</a></h2>
<section id="nhits-overview">
<h3>NHITS Overview<a class="headerlink" href="#nhits-overview" title="Permalink to this heading">#</a></h3>
<p align="center">
<img width="750" alt="NHITS Architecture" src="https://user-images.githubusercontent.com/34798787/156445832-58e5e082-5003-4859-92f6-cb029ddbd378.png">
</p>
<p>NHITS is a popular deep learning based approach to time series forecasting. In particualr, NHITS adapts the NBEATS architecture to perform long sequence time series forecasting (LSTF); a task where the length of the input and output sequence are large. NHITS learns a global model from historical data of one or more time series. Thus, although the input and output space is univariate, NHITS can be used to jointly model a set of related time series. The architecture consists of deep stacks of fully connected layers connected with forward and backward residual links. The forwad links aggregate partial forecast to yield final forecast. Alternatively, backward links subtract out input signal corresponding to already predicted partial forecast from input prior to being passed to the next stack. NHITS builds on NBEATS by enhancing its input decomposition via multi-rate data sampling and its output synthesizer via multi-scale interpolation. This increases both the accuracy and  computational efficiency of the approach in the LSTF setting.</p>
<p>Some of the additonal benefits of NHITS include:</p>
<ul class="simple">
<li><p><strong>Interpretability</strong>: Allows for hierarchical decomposition of a forecasts into trend and seasonal components which enhances interpretability.</p></li>
<li><p><strong>Ensembling</strong>: Ensembles models fit with different loss functions and time horizons. The final prediction is mean of models in ensemble.</p></li>
<li><p><strong>Efficient</strong>: Avoids the use of recurrent structute and predicts entire ouput sequence in single forward pass.</p></li>
<li><p><strong>Covariates</strong>: NHITS allows for the inclusion of covariates compared to NBEATS which does not.</p></li>
</ul>
</section>
<section id="model-definition">
<h3>Model Definition<a class="headerlink" href="#model-definition" title="Permalink to this heading">#</a></h3>
<p>Using the Pytorch Forecasting package, an NHITS model can easily be initialized using the <code class="docutils literal notranslate"><span class="pre">NHiTS.from_dataset</span></code> method. This method constructs a NHITS model using the characteristics of the TimeSeriesDataset that it is operating on. The arguments of the method include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dataset</span></code>: (TimeSeriesDataset) time series dataset</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hidden_size</span></code>: (int) – size of hidden layers and can range from 8 to 1024 - use 32-128 if no covariates are employed. Defaults to 512.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">learning_rate</span></code>: (float) The learning rate of the optimization procedure.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">weight_decay</span></code>: (float) The weight decay that is applied to the model parameters.</p></li>
</ul>
<p>PyTorch Forecasting is flexible enough to use NHiTS with different loss functions, enabling not only point forecasts but also probabilistic ones. Here, we will demonstrate not only a typical quantile regression but a multivariate quantile regression with MQF2DistributionLoss which allows calculation sampling consistent paths along a prediction horizon.</p>
<p>For additional details in regards to the <code class="docutils literal notranslate"><span class="pre">NHiTS</span></code> class, consult the  <a class="reference external" href="https://pytorch-forecasting.readthedocs.io/en/stable/api/pytorch_forecasting.models.nhits.NHiTS.html#pytorch_forecasting.models.nhits.NHiTS">PyTorch Forecasting Documentation</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pl</span><span class="o">.</span><span class="n">seed_everything</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">NHiTS</span><span class="o">.</span><span class="n">from_dataset</span><span class="p">(</span>
    <span class="n">training</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.09</span><span class="p">,</span>
    <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">MQF2DistributionLoss</span><span class="p">(</span><span class="n">prediction_length</span><span class="o">=</span><span class="n">max_prediction_length</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:lightning_fabric.utilities.seed:Global seed set to 42
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="training-and-validation">
<h2>Training and Validation<a class="headerlink" href="#training-and-validation" title="Permalink to this heading">#</a></h2>
<p>We first define a pytorch lighting trainer which encapsulates the training process and allows us to easily implement a training and validation loop with the specified parameters. The arguments to the trainer include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max_epochs</span></code>: (Optional[int]) – Stop training once this number of epochs is reached.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gpus</span></code>: (Union[int, None]) Number of GPUs to train on (int). Default: None.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">callbacks</span></code>: (Union[List[Callback], Callback, None]) – Add a callback or list of callbacks.</p></li>
</ul>
<p>Subsequently, we can use the <code class="docutils literal notranslate"><span class="pre">fit</span></code> method of the trainer with the <code class="docutils literal notranslate"><span class="pre">net</span></code>, <code class="docutils literal notranslate"><span class="pre">train_dataloader</span></code> and <code class="docutils literal notranslate"><span class="pre">val_dataloader</span></code> to perform the training and validation loop.</p>
<p>For more information regarding the <code class="docutils literal notranslate"><span class="pre">pl.Trainer</span></code> class, consult the <a class="reference external" href="https://pytorch-lightning.readthedocs.io/en/stable/api/pytorch_lightning.trainer.trainer.html#pytorch_lightning.trainer.trainer.Trainer.validate">PyTorch Lightning documentation</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">early_stop_callback</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s2">&quot;val_loss&quot;</span><span class="p">,</span> <span class="n">min_delta</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">)</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span>
    <span class="n">max_epochs</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
    <span class="n">gpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">enable_model_summary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stop_callback</span><span class="p">],</span>
    <span class="n">enable_checkpointing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">net</span><span class="p">,</span>
    <span class="n">train_dataloaders</span><span class="o">=</span><span class="n">train_dataloader</span><span class="p">,</span>
    <span class="n">val_dataloaders</span><span class="o">=</span><span class="n">val_dataloader</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-forecasts">
<h2>Visualize Forecasts<a class="headerlink" href="#visualize-forecasts" title="Permalink to this heading">#</a></h2>
<section id="quantile-forecasts">
<h3>Quantile Forecasts<a class="headerlink" href="#quantile-forecasts" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_model_path</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">checkpoint_callback</span><span class="o">.</span><span class="n">best_model_path</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">NHiTS</span><span class="o">.</span><span class="n">load_from_checkpoint</span><span class="p">(</span><span class="n">best_model_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_predictions</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_dataloader</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span> <span class="n">return_x</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>  <span class="c1"># plot 10 examples</span>
    <span class="n">best_model</span><span class="o">.</span><span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">raw_predictions</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dd10e1d9c7e70b3d47b727a4a42dbd340c557d33106cf66d497a9e14721dce44.png" src="../_images/dd10e1d9c7e70b3d47b727a4a42dbd340c557d33106cf66d497a9e14721dce44.png" />
<img alt="../_images/dac9e001129e45ff070b396b1ff2f30b7016a7c3840b24bbe788b4cf8a5fdcf2.png" src="../_images/dac9e001129e45ff070b396b1ff2f30b7016a7c3840b24bbe788b4cf8a5fdcf2.png" />
<img alt="../_images/52a721ff0a844e2696888eb90d8283a515ffe3fa5b49bcfa57fa01a9139886e5.png" src="../_images/52a721ff0a844e2696888eb90d8283a515ffe3fa5b49bcfa57fa01a9139886e5.png" />
<img alt="../_images/9175caa3224cb30c3646b6f55a6082bbb2ec4fe510cbc1e587fd600786011f7e.png" src="../_images/9175caa3224cb30c3646b6f55a6082bbb2ec4fe510cbc1e587fd600786011f7e.png" />
<img alt="../_images/c96cfc1392d94b0bfa52911fa59eb2bd677c29d8ce5174c34c90bef2ee11fbb9.png" src="../_images/c96cfc1392d94b0bfa52911fa59eb2bd677c29d8ce5174c34c90bef2ee11fbb9.png" />
</div>
</div>
</section>
<section id="interpretable-forecasts">
<h3>Interpretable Forecasts<a class="headerlink" href="#interpretable-forecasts" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>  <span class="c1"># plot 10 examples</span>
    <span class="n">best_model</span><span class="o">.</span><span class="n">plot_interpretation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">raw_predictions</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/377fe218ce61dae391e87a116c0173a75ddc10c249ce5ced77042e6232b6ad64.png" src="../_images/377fe218ce61dae391e87a116c0173a75ddc10c249ce5ced77042e6232b6ad64.png" />
<img alt="../_images/a250526c57aa70516cd192903c79d00a2c02b37b369c22e9f7db05d99007d0e5.png" src="../_images/a250526c57aa70516cd192903c79d00a2c02b37b369c22e9f7db05d99007d0e5.png" />
</div>
</div>
</section>
<section id="sampling-forecasts">
<h3>Sampling Forecasts<a class="headerlink" href="#sampling-forecasts" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sample 500 paths</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">raw_predictions</span><span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">][[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># plot prediction</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">raw_predictions</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">add_loss_to_title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># plot first two sampled paths</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">samples</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sample 1&quot;</span><span class="p">,</span> <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">samples</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sample 2&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/082609ff0985e8e7e07652abcf7cfad22212903665a8d088075ab30b75e85da3.png" src="../_images/082609ff0985e8e7e07652abcf7cfad22212903665a8d088075ab30b75e85da3.png" />
</div>
</div>
<p>As expected, the variance of predictions is smaller within each sample than accross all samples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Var(all samples) = </span><span class="si">{</span><span class="n">samples</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean(Var(sample)) = </span><span class="si">{</span><span class="n">samples</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Var(all samples) = 0.1378
Mean(Var(sample)) = 0.1246
</pre></div>
</div>
</div>
</div>
<p>We can now do something new and plot the distribution of sums of forecasts over the entire prediction range.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Sum of predictions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8ccd717424a1c2dce0687801f8bcf114d72728cc55b792b5761e7e370d1c4e41.png" src="../_images/8ccd717424a1c2dce0687801f8bcf114d72728cc55b792b5761e7e370d1c4e41.png" />
</div>
</div>
</section>
</section>
<section id="quantitative-results">
<h2>Quantitative Results<a class="headerlink" href="#quantitative-results" title="Permalink to this heading">#</a></h2>
<p>In order to quantitatively assess the performance of the model we can use the <a class="reference external" href="https://en.wikipedia.org/wiki/Symmetric_mean_absolute_percentage_error">Symmetric Mean Absolute Percentage Error</a>. Pytorch Forecasting includes this and other metrics in the <code class="docutils literal notranslate"><span class="pre">pytorch_forecasting.metrics</span></code> module. As a baseline, we can also define a naive forecasting model, <code class="docutils literal notranslate"><span class="pre">pytorch_forecasting.Baseline</span></code>, that produces forecasts by repeating the last known value in the time series. Unsurprisingly, the NHITS model is able to outperform this naive baseline.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate baseline absolute error</span>
<span class="n">actuals</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">val_dataloader</span><span class="p">)])</span>
<span class="n">baseline_predictions</span> <span class="o">=</span> <span class="n">Baseline</span><span class="p">()</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_dataloader</span><span class="p">)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_dataloader</span><span class="p">)</span>
<span class="n">baseline_smape</span> <span class="o">=</span> <span class="n">SMAPE</span><span class="p">()(</span><span class="n">baseline_predictions</span><span class="p">,</span> <span class="n">actuals</span><span class="p">)</span>
<span class="n">nhits_smape</span> <span class="o">=</span> <span class="n">SMAPE</span><span class="p">()(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">actuals</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">nhits_smape</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">baseline_smape</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.14025408029556274 0.5462026596069336
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "ptf"
        },
        kernelOptions: {
            name: "ptf",
            path: "./multivariate_demos"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ptf'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="nbeats_electricity.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Multivariate Forecasting with NBEATS</p>
      </div>
    </a>
    <a class="right-next"
       href="README.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Multivariate Forecasting Demo Notebooks</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#package-imports-and-global-variables">Package Imports and Global Variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-data">Load Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model">Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nhits-overview">NHITS Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-definition">Model Definition</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-and-validation">Training and Validation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-forecasts">Visualize Forecasts</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quantile-forecasts">Quantile Forecasts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretable-forecasts">Interpretable Forecasts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sampling-forecasts">Sampling Forecasts</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quantitative-results">Quantitative Results</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Vector Institute
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright Vector Institute.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>